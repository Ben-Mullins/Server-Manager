@page "/Tracker/{ProjectId:int}/Security"
@model ServerProjectTracker.Pages.Tracker.EditProjectSecurityModel
@{
    ViewData["Title"] = "Project Security";
}

<div class="row">
    <div class="col-2" style="padding-top: 1.5rem">
        <div class="card text-center">
            <ul class="list-group list-group-flush">
                @if (Model.Project.ProjectLink != null && Model.Project.ProjectLink != "")
                {
                    <li class="list-group-item"><a href="@Model.Project.ProjectLink">Project Page</a></li>
                }
                <li class="list-group-item"><a asp-page="/Tracker/Details" asp-route-ProjectId="@Model.Project.ProjectId">Project Details</a></li>
                <li class="list-group-item"><a asp-page="/Tracker/EditProjectBasic" asp-route-ProjectId="@Model.Project.ProjectId">Edit Project</a></li>
                <li class="list-group-item"><a asp-page="/Tracker/EditProjectSecurity" asp-route-ProjectId="@Model.Project.ProjectId">Security</a></li>
                <li class="list-group-item"><a asp-page="/Tracker/Index">Tracker Home</a></li>
            </ul>
        </div>
    </div>
    <div class="col-10">
        <h1>@Model.Project.ProjectTitle</h1>
        <h2 style="margin-bottom: 1rem">Project Security</h2>

        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">Username</th>
                    <th scope="col">Access Granted Date</th>
                    <th scope="col">Access Update Date</th>
                    <th scope="col">Access Granter</th>
                    <th scope="col">Access Level</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var rule in Model.ProjectAccessRules)
                {
                <tr>
                    <th scope="row">@rule.User.Username</th>
                    <td>@rule.AccessGrantedDate.ToString("MM/dd/yyyy")</td>
                    <td>
                        @if (rule.AccessUpdatedDate != null) { 
                        <div>@((DateTime)rule.AccessUpdatedDate).ToString("MM/dd/yyyy")</div> 
                        }
                        else
                        {
                        <div>N/A</div>
                        }
                    </td>
                    <td>@rule.AccessGranter.Username</td>
                    <td>
                        @if (Model.UserId == rule.User.UserId)
                        {
                            <select class="form-control" disabled>
                                <option selected='@rule.AccessLevel == 1 ? "selected" : "false"' value="1">Developer</option>
                                <option selected='@rule.AccessLevel == 0 ? "selected" : "false"' value="0">Owner</option>
                                <option selected='@rule.AccessLevel == 2 ? "selected" : "false"' value="2">Viewer</option>
                            </select>
                        }
                        else
                        {
                            <select class="form-control">
                                <option value="0">Owner</option>
                                <option value="1">Developer</option>
                                <option value="2">Viewer</option>
                            </select>
                        }

                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
</div>
